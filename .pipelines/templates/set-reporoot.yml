parameters:
- name: ob_restore_phase
  type: boolean
  default: true

steps:
- pwsh: |
    $path = "./build.psm1"
    if($env:REPOROOT){
      Write-Verbose "reporoot already set to ${env:REPOROOT}" -Verbose
      exit 0
    }
    if(Test-Path -Path $path)
    {
      Write-Verbose "reporoot detected at: ." -Verbose
      $repoRoot = '.'
    }
    else{
      $path = "./PowerShell/build.psm1"
      if(Test-Path -Path $path)
      {
        Write-Verbose "reporoot detected at: ./PowerShell" -Verbose
        $repoRoot = './PowerShell'
      }
    }
    if($repoRoot) {
      $vstsCommandString = "vso[task.setvariable variable=repoRoot]$repoRoot"
      Write-Host ("sending " + $vstsCommandString)
      Write-Host "##$vstsCommandString"
    } else {
      Write-Verbose -Verbose "repo not found"
    }
  displayName: 'Set repo Root'
  env:
    ob_restore_phase: ${{ parameters.ob_restore_phase }}
