name: Windows-CI
on:
  push:
    branches:
    - master
    - release*
    - feature*
    paths:
    - "*"
    - "!.vsts-ci/misc-analysis.yml"
    - "!.github/ISSUE_TEMPLATE/*"
    - "!.github/workflows/*"
    - "!.dependabot/config.yml"
    - "!test/perf/*"
    - "!.pipelines/*"
  pull_request:
    branches:
    - master
    - release*
    - feature*
    paths:
    - ".vsts-ci/templates/*"
    - ".vsts-ci/windows.yml"
    - "*.props"
    - build.psm1
    - src/*
    - test/*
    - tools/buildCommon/*
    - tools/ci.psm1
    - tools/WindowsCI.psm1
    - "!test/common/markdown/*"
    - "!test/perf/*"
env:
  DOTNET_CLI_TELEMETRY_OPTOUT: 1
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
  GIT_CONFIG_PARAMETERS: "'core.autocrlf=false'"
  NugetSecurityAnalysisWarningLevel: none
  POWERSHELL_TELEMETRY_OPTOUT: 1
  __SuppressAnsiEscapeSequences: 1
  nugetMultiFeedWarnLevel: none
jobs:
  ci_build:
    name: ci_build
    uses: "./.github/workflows/templates/build/ci.yml"
  windows_test:
    name: windows_test
    needs: ci_build
    uses: "./.github/workflows/templates/test/windows.yml"
    with:
      purpose: UnelevatedPesterTests
      tagSet: CI
  windows_test_2:
    name: windows_test_2
    needs: ci_build
    uses: "./.github/workflows/templates/test/windows.yml"
    with:
      purpose: ElevatedPesterTests
      tagSet: CI
  windows_test_3:
    name: windows_test_3
    needs: ci_build
    uses: "./.github/workflows/templates/test/windows.yml"
    with:
      purpose: UnelevatedPesterTests
      tagSet: Others
  windows_test_4:
    name: windows_test_4
    needs: ci_build
    uses: "./.github/workflows/templates/test/windows.yml"
    with:
      purpose: ElevatedPesterTests
      tagSet: Others
  verify_xunit:
    name: verify_xunit
    needs: ci_build
    uses: "./.github/workflows/templates/verify_xunit.yml"
