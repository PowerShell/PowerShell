name: verify_xunit
description: 'Verify xUnit Results'

runs:
  using: composite
  steps:
  - name: Download build artifacts
    uses: actions/download-artifact@v4
    with:
      path: "${{ github.workspace }}"
  - name: Capture artifacts directory
    continue-on-error: true
    run: dir "${{ github.workspace }}\xunit\*" -Recurse
    shell: pwsh
  - name: Test
    if: success()
    run: |-
      Import-Module .\tools\ci.psm1
      $xUnitTestResultsFile = "${{ github.workspace }}\xunit\xUnitTestResults.xml"
      Test-XUnitTestResults -TestResultsFile $xUnitTestResultsFile
    shell: pwsh
  - name: Publish Test Results
    uses: EnricoMi/publish-unit-test-result-action/windows@v2
    if: always()
    with:
      files: |
        ${{ github.workspace }}\xunit\xUnitTestResults.xml
      check_name: ${{ runner.os }} ${{ runner.arch }} xUnit
      comment_mode: failures
